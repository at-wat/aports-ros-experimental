# Contributor: Florent Ferreri <florent@seqsense.com>
pkgname=ifm3d
pkgver=0.18.0
pkgrel=0
pkgdesc="Library and Utilities for working with ifm pmd-based 3D ToF Cameras"
url="https://github.com/ifm/ifm3d"
arch="all"
license="MIT"
options="!check" # Run into this error when trying to build tests: add_subdirectory given source "/usr/src/gtest" which is not an existing directory.
depends_dev="curl-dev glog-dev opencv-dev pcl-dev xmlrpc-c-dev"
makedepends="cmake curl-dev glog-dev opencv-dev pcl-dev xmlrpc-c-dev"
subpackages="$pkgname-dev $pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/ifm/$pkgname/archive/refs/tags/v${pkgver}.tar.gz
    endianness-check-fix.patch
    "
builddir="$srcdir/$pkgname-$pkgver"

build() {
    mkdir build
    cd build
    cmake \
      -DCMAKE_INSTALL_PREFIX=/usr \
      -DBUILD_MODULE_OPENCV=ON \
      -DBUILD_MODULE_PCICCLIENT=ON \
      -DBUILD_MODULE_PYBIND11=OFF \
      -DBUILD_TESTS=false \
      -DCMAKE_BUILD_TYPE=Release ..
    make
}

package() {
    cd "$builddir/build"
    make DESTDIR="$pkgdir" install
    install -Dm 0644 "$builddir"/LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
    install -Dm 0644 "$builddir"/LICENSE.MIT "$pkgdir"/usr/share/licenses/$pkgname/LICENSE.MIT
}

sha512sums="6882065e7eefc509c59467fe341ef4dccdc2e7db9525f9036ac19887d369576925b66adf2dc974aaabac72f6ffd0028ae0dac1902c0319f85e2b27ac33a2063a  ifm3d-0.18.0.tar.gz
50fb79d73ccd3b2f8c8a2bedbb40f2d3435337fafb3823e8e386e15c9d37b3ddcdcf469aa2c4aebd3a82a04c15e4d9fef6f39d750fcfa7fcf9748111665aa729  endianness-check-fix.patch"
