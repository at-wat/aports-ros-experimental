pkgname=ros-kinetic-catkin
_pkgname=catkin
pkgver=0.7.14
pkgrel=0
pkgdesc="$_pkgname package for ROS kinetic"
url="http://www.ros.org/wiki/catkin"
arch="all"
license="BSD"
depends="py2-argparse py2-catkin-pkg cmake gmock-dev gtest-dev gtest py2-empy py2-nose py2-argparse py2-catkin-pkg"
makedepends="py-setuptools cmake py2-empy py2-argparse py2-catkin-pkg py2-mock py2-nose"
subpackages=""
source=""
builddir="$startdir/apk-build-temporary"
srcdir="/tmp/dummy-src-dir"
buildlog="$builddir/ros-abuild-build.log"
checklog="$builddir/ros-abuild-check.log"
statuslog="$builddir/ros-abuild-status.log"
if [ x${GENERATE_BUILD_LOGS} != "xyes" ]; then
  buildlog="/dev/null"
  checklog="/dev/null"
  statuslog="/dev/null"
fi
rosinstall="- git: {local-name: catkin, uri: 'https://github.com/ros-gbp/catkin-release.git',
    version: release/kinetic/catkin/0.7.14-0}
"
build() {
  set -o pipefail
  mkdir -p $builddir
  echo "building" > $statuslog
  cd "$builddir"
  rm -rf src || true
  mkdir -p src
  echo "$rosinstall" > pkg.rosinstall
  wstool init --shallow src pkg.rosinstall
  mkdir src/$_pkgname/build
  cd src/$_pkgname/build
  cmake .. -DCMAKE_INSTALL_PREFIX=/usr/ros/kinetic -DCMAKE_INSTALL_LIBDIR=lib 2>&1 | tee $buildlog
  make 2>&1 | tee -a $buildlog
}
check() {
  if [ -f $startdir/NOCHECK ]; then
    echo "Check skipped" | tee $checklog
    return 0
  fi
  set -o pipefail
  echo "checking" >> $statuslog
  cd "$builddir"
  cd src/$_pkgname/build
  if [ `make -q test > /dev/null 2> /dev/null; echo $?` -eq 1 ]; then
    make test 2>&1 | tee $checklog
  fi
}
package() {
  echo "packaging" >> $statuslog
  mkdir -p "$pkgdir"
  cd "$builddir"
  export DESTDIR="$pkgdir"
  cd src/$_pkgname/build
  make install
  echo "finished" >> $statuslog
}
